<?php if (empty($favourite)) {
    return;
} ?>
<?php
// Load language file
Pi::service('i18n')->load(array('module/favourite', 'default'));
// Set icon
$configFavourite = Pi::service('registry')->config->read('favourite', 'favourite');
switch ($configFavourite['favourite_icon']) {
    case 'wishlist':
        $favourite['icon'] = ($favourite['is']) ? 'fa-check' : '';
        $favourite['iconbar'] = ($favourite['is']) ? __('Add to Wishlist ?') : __('Whishlist !');
        $favourite['iconclass'] = ($favourite['is']) ? 'favouritebar-btn btn btn-success' : 'favouritebar-btn btn btn-primary';
        break;

    case 'bookmark':
        $favourite['icon'] = ($favourite['is']) ? 'fa-bookmark' : 'fa-bookmark-o';
        $favourite['iconbar'] = 'bookmark';
        $favourite['iconclass'] = 'favouritebar-icon';
        break;

    case 'heart':
        $favourite['icon'] = ($favourite['is']) ? 'fa-heart' : 'fa-heart-o';
        $favourite['iconbar'] = 'heart';
        $favourite['iconclass'] = 'favouritebar-icon';
        break;

    case 'star':
    default:
        $favourite['icon'] = ($favourite['is']) ? 'fa-star' : 'fa-star-o';
        $favourite['iconbar'] = 'star';
        $favourite['iconclass'] = 'favouritebar-icon';
        break;
}
// Set html id
$favourite['htmlId'] = sprintf('favourite-%s-%s-%s', $favourite['module'], $favourite['table'], $favourite['item']);
// Set class
$favouriteClass = isset($favourite['class']) ? $favourite['class'] : '';
// Set tooltip text
$favourite['tooltip'] = ($favourite['is']) ? __('Remove favourite') : __('Declare as favourite');
// Load jQuery
$this->jQuery();
// Load js files
if ($configFavourite['favourite_icon'] == 'wishlist') {
    $this->js($this->assetModule('script/favourite.wishlist.js', 'favourite'));
} else {
    $this->js($this->assetModule('script/favourite.js', 'favourite'));
}
// Load css files
$this->css($this->assetModule('script/favourite.css', 'favourite'));

// Set onclick
$onclick = <<<'EOT'
setFavourite('%s', '%s', '%s', '%s', '%s', '%s', '%s');
EOT;
$onclick = sprintf($onclick,
    Pi::url('favourite', true),
    $favourite['item'],
    $favourite['table'],
    $favourite['module'],
    $favourite['iconbar'],
    Pi::user()->config('enable_modal') ? 'true' : 'false',
    __('login/register')
);
?>
<div class="favouritebar <?php echo $favouriteClass; ?>">
    <a class="<?php echo $favourite['iconclass']; ?>" data-toggle="tooltip" data-placement="top"
       title="<?php echo $favourite['tooltip']; ?>"
       id="<?php echo $favourite['htmlId']; ?>" onclick="<?php echo $onclick; ?>">
        <?php if ($favourite['icon']) { ?>
        <i class="fa <?php echo $favourite['icon']; ?>"></i>
        <?php } ?>
        <?php if ($configFavourite['favourite_icon'] == 'wishlist') {
            echo ($favourite['is']) ? __('Whishlist !') : __('Add to Wishlist ?');
        } ?>
    </a>
    <?php if ($configFavourite['favourite_view_count'] && isset($favorite['count']) && $favorite['count']) { ?>
        <div class="favorite-count">
            <span class="label label-default"><?php echo _number($favorite['count']); ?></span>
        </div>
    <?php } ?>
</div>